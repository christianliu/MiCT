
#info.info.index-col
	.notice= flash[:success]
	%h1
		%a{href: new_company_path} New Company
		
#map.map

.index-col
	:javascript
		var map = L.mapbox.map('map', 'examples.h186knp8').setView([-33.93, 18.42], 15);
		var myLayer = L.mapbox.featureLayer().addTo(map);

		myLayer.setGeoJSON([{
			  type: 'Feature',
			  geometry: {
				  type: 'Point',
				  coordinates: [#{@companies.first.longitude}, #{@companies.first.latitude}]
			  },
			  properties: {
				  title: '<img class="result logo" src="#{@companies.first.avatar.url}" style="float:right;"><h3>#{@companies.first.name}</h3>',
				  description: '#{@companies.first.location}',
				  'marker-id': 'marker-1',
				  'marker-color': '#f86767'
			  }
		  },
		  {
			  type: 'Feature',
			  geometry: {
				  type: 'Point',
				  coordinates: [#{@companies.second.longitude}, #{@companies.second.latitude}]
			  },
			  properties: {
				  title: '<img class="result logo" src="#{@companies.second.avatar.url}" style="float:right;"><h3>#{@companies.second.name}</h3>',
				  description: '#{@companies.second.location}',
				  'marker-id': 'marker-1',
				  'marker-color': '#f86767'
			  }
		  },
		  {
			  type: 'Feature',
			  geometry: {
				  type: 'Point',
				  coordinates: [#{@companies.third.longitude}, #{@companies.third.latitude}]
			  },
			  properties: {
				  title: '<img class="result logo" src="#{@companies.third.avatar.url}" style="float:right;"><h3>#{@companies.third.name}</h3>',
				  description: '#{@companies.third.location}',
				  'marker-id': 'marker-1',
				  'marker-color': '#f86767'
			  }
		  },
		  {
			  type: 'Feature',
			  geometry: {
				  type: 'Point',
				  coordinates: [#{@companies.fourth.longitude}, #{@companies.fourth.latitude}]
			  },
			  properties: {
				  title: '<img class="result logo" src="#{@companies.fourth.avatar.url}" style="float:right;"><h3>#{@companies.fourth.name}</h3>',
				  description: '#{@companies.fourth.location}',
				  'marker-id': 'marker-1',
				  'marker-color': '#f86767'
			  }
		  },
		]);
	  
		var info = document.getElementById('info');

		// Iterate through each feature layer item, build a
		// marker menu item and enable a click event that pans to + opens
		// a marker that's associated to the marker item.
		myLayer.eachLayer(function(marker) {
		var link = info.appendChild(document.createElement('a'));
		link.className = 'item';
		link.href = '#';

		// Populate content from each markers object.
		link.innerHTML = marker.feature.properties.title +
		  '' + marker.feature.properties.description + '';
		link.onclick = function() {
		  if (/active/.test(this.className)) {
			this.className = this.className.replace(/active/, '').replace(/\s\s*$/, '');
		  } else {
			var siblings = info.getElementsByTagName('a');
			for (var i = 0; i < siblings.length; i++) {
			  siblings[i].className = siblings[i].className
				.replace(/active/, '').replace(/\s\s*$/, '');
			};
			this.className += ' active';

			// When a menu item is clicked, animate the map to center
			// its associated marker and open its popup.
			map.panTo(marker.getLatLng());
			marker.openPopup();
		  }
		  return false;
		};
		});

