%section.listing#info
    .notice= flash[:success]
    .notice= flash[:error]

    = form_tag root_path, :method => 'get', id: 'search' do
        = search_field_tag('search_term', params[:search_term], :placeholder =>"Search...")
        = submit_tag "Go", :title => nil

    / = search_form_for @search do |f|
    /     = f.label :name_cont, "Name contains"
    /     = f.text_field :name_cont
    /     = f.submit "Search"


%section.map#map

:javascript
    var map = L.mapbox.map('map', 'examples.h186knp8').setView([-33.93, 18.42], 15);
    var myLayer = L.mapbox.featureLayer().addTo(map);

    loadMarkers = function(data) {myLayer.setGeoJSON(data);
    var info = document.getElementById('info');

    // Iterate through each feature layer item, build a
    // marker menu item and enable a click event that pans to + opens
    // a marker that's associated to the marker item.
    myLayer.eachLayer(function(marker) {
    var link = info.appendChild(document.createElement('a'));
    link.className = 'item';
    link.href = '#';

    // Populate content from each markers object.
    link.innerHTML = marker.feature.properties.title +
      '' + marker.feature.properties.description + '';
    link.onclick = function() {
      if (/active/.test(this.className)) {
        this.className = this.className.replace(/active/, '').replace(/\s\s*$/, '');
      } else {
        var siblings = info.getElementsByTagName('a');
        for (var i = 0; i < siblings.length; i++) {
          siblings[i].className = siblings[i].className
            .replace(/active/, '').replace(/\s\s*$/, '');
        };
        this.className += ' active';

        // When a menu item is clicked, animate the map to center
        // its associated marker and open its popup.
        map.panTo(marker.getLatLng());
        marker.openPopup();
      }
      return false;
    };
    });


     };

    $.ajax({
        type: "GET",
        url: "/companies",
        dataType: "json",
        success: loadMarkers
    });